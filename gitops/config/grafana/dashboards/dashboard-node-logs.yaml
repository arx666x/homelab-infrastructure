apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-node-logs
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana-folder: Loki
data:
  node-logs.json: |-
    {"annotations":{"list":[]},"description":"Node-level logs via Loki - kernel, systemd, and node-level events","editable":true,"graphTooltip":0,"id":null,"links":[],"panels":[{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":10},{"color":"red","value":100}]}},"overrides":[]},"gridPos":{"h":4,"w":8,"x":0,"y":0},"id":1,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Node Errors (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({job=\"node-logs\", node=~\"$node\"} |~ \"(?i)(error|fail|critical)\" [1h]))","legendFormat":"Errors","refId":"A"}]},{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":5},{"color":"red","value":20}]}},"overrides":[]},"gridPos":{"h":4,"w":8,"x":8,"y":0},"id":2,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"OOM Kills (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({job=\"node-logs\", node=~\"$node\"} |~ \"Out of memory|oom_kill\" [1h]))","legendFormat":"OOM Kills","refId":"A"}]},{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":1}]}},"overrides":[]},"gridPos":{"h":4,"w":8,"x":16,"y":0},"id":3,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Kernel Panics (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({job=\"node-logs\", node=~\"$node\"} |~ \"kernel panic\" [1h]))","legendFormat":"Panics","refId":"A"}]},{"datasource":"${datasource}","gridPos":{"h":10,"w":24,"x":0,"y":4},"id":4,"options":{"dedupStrategy":"none","enableLogDetails":true,"showLabels":true,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"expr":"{namespace=\"kube-system\", pod=~\".*$node.*\"} |~ \"$search\"","refId":"A"}],"title":"Kubernetes System Logs (kube-system)","type":"logs"},{"datasource":"${datasource}","gridPos":{"h":10,"w":24,"x":0,"y":14},"id":5,"options":{"dedupStrategy":"none","enableLogDetails":true,"showLabels":true,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"expr":"{namespace=~\"$namespace\"} |~ \"(?i)(error|warn|fail|exception)\" |~ \"$search\"","refId":"A"}],"title":"Error & Warning Logs across all Namespaces","type":"logs"}],"refresh":"30s","schemaVersion":30,"style":"dark","tags":["loki","node","kubernetes"],"templating":{"list":[{"current":{},"hide":0,"includeAll":false,"label":"Loki Datasource","name":"datasource","options":[],"query":"loki","refresh":1,"type":"datasource"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values(namespace)","hide":0,"includeAll":true,"label":"Namespace","multi":true,"name":"namespace","query":"label_values(namespace)","refresh":2,"sort":1,"type":"query"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values(node)","hide":0,"includeAll":true,"label":"Node","multi":false,"name":"node","query":"label_values(node)","refresh":2,"sort":1,"type":"query"},{"current":{"selected":false,"text":"","value":""},"hide":0,"label":"Search","name":"search","query":"","type":"textbox"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Node Logs","uid":"node-logs","version":1}
