apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-loki-logs-app
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana-folder: Loki
data:
  loki-logs-app.json: |-
    {"__inputs":[{"name":"DS_LOKI","label":"Loki","description":"","type":"datasource","pluginId":"loki","pluginName":"Loki"}],"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"7.3.0"},{"type":"datasource","id":"loki","name":"Loki","version":"1.0.0"},{"type":"panel","id":"logs","name":"Logs","version":""},{"type":"panel","id":"stat","name":"Stat","version":""}],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"Loki Logs Viewer","editable":true,"gnetId":13639,"graphTooltip":0,"id":null,"iteration":1612753555555,"links":[],"panels":[{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":4,"w":24,"x":0,"y":0},"id":2,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.3.6","title":"Log Volume","type":"stat","targets":[{"expr":"sum(count_over_time({app=~\"$app\", namespace=~\"$namespace\"}[$__interval]))","legendFormat":"Log Count","refId":"A"}]},{"datasource":"${datasource}","gridPos":{"h":25,"w":24,"x":0,"y":4},"id":4,"options":{"dedupStrategy":"none","showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":true},"targets":[{"expr":"{app=~\"$app\", namespace=~\"$namespace\"} |~ \"$search\"","refId":"A"}],"title":"Logs","type":"logs"}],"refresh":"10s","schemaVersion":27,"style":"dark","tags":["loki","logs"],"templating":{"list":[{"current":{},"hide":0,"includeAll":false,"label":"Datasource","name":"datasource","options":[],"query":"loki","refresh":1,"type":"datasource"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values(namespace)","hide":0,"includeAll":true,"label":"Namespace","multi":true,"name":"namespace","query":"label_values(namespace)","refresh":2,"sort":1,"type":"query"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values({namespace=~\"$namespace\"}, app)","hide":0,"includeAll":true,"label":"App","multi":true,"name":"app","query":"label_values({namespace=~\"$namespace\"}, app)","refresh":2,"sort":1,"type":"query"},{"current":{},"hide":0,"label":"Search","name":"search","query":"","type":"textbox"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Logs / App","uid":"loki-logs-app","version":1}
