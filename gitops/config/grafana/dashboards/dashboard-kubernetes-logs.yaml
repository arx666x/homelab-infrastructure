apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-kubernetes-logs
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana-folder: Loki
data:
  kubernetes-logs.json: |-
    {"annotations":{"list":[]},"description":"Kubernetes cluster logs via Loki - browse logs by namespace, pod, and container","editable":true,"graphTooltip":0,"id":null,"links":[],"panels":[{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":0},"id":1,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Total Log Lines (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({namespace=~\"$namespace\"}[1h]))","legendFormat":"Total","refId":"A"}]},{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":10},{"color":"red","value":100}]}},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":0},"id":2,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Errors (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({namespace=~\"$namespace\"} |~ \"(?i)(error|exception|fatal|critical)\" [1h]))","legendFormat":"Errors","refId":"A"}]},{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":50},{"color":"red","value":500}]}},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":0},"id":3,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Warnings (1h)","type":"stat","targets":[{"expr":"sum(count_over_time({namespace=~\"$namespace\"} |~ \"(?i)(warn|warning)\" [1h]))","legendFormat":"Warnings","refId":"A"}]},{"datasource":"${datasource}","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":0},"id":4,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"title":"Active Pods logging","type":"stat","targets":[{"expr":"count(count by (pod) (count_over_time({namespace=~\"$namespace\", pod=~\"$pod\"}[5m])))","legendFormat":"Pods","refId":"A"}]},{"datasource":"${datasource}","gridPos":{"h":20,"w":24,"x":0,"y":4},"id":5,"options":{"dedupStrategy":"none","enableLogDetails":true,"showLabels":true,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"expr":"{namespace=~\"$namespace\", pod=~\"$pod\", container=~\"$container\"} |~ \"$search\"","refId":"A"}],"title":"Logs","type":"logs"}],"refresh":"30s","schemaVersion":30,"style":"dark","tags":["loki","kubernetes","logs"],"templating":{"list":[{"current":{},"hide":0,"includeAll":false,"label":"Loki Datasource","name":"datasource","options":[],"query":"loki","refresh":1,"type":"datasource"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values(namespace)","hide":0,"includeAll":true,"label":"Namespace","multi":true,"name":"namespace","query":"label_values(namespace)","refresh":2,"sort":1,"type":"query"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values({namespace=~\"$namespace\"}, pod)","hide":0,"includeAll":true,"label":"Pod","multi":true,"name":"pod","query":"label_values({namespace=~\"$namespace\"}, pod)","refresh":2,"sort":1,"type":"query"},{"allValue":".*","current":{},"datasource":"${datasource}","definition":"label_values({namespace=~\"$namespace\", pod=~\"$pod\"}, container)","hide":0,"includeAll":true,"label":"Container","multi":true,"name":"container","query":"label_values({namespace=~\"$namespace\", pod=~\"$pod\"}, container)","refresh":2,"sort":1,"type":"query"},{"current":{"selected":false,"text":"","value":""},"hide":0,"label":"Search","name":"search","query":"","type":"textbox"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Kubernetes Cluster Logs","uid":"kubernetes-cluster-logs","version":1}
