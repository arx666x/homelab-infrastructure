apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-loki-stack-monitoring
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana-folder: Loki
data:
  loki-stack-monitoring.json: |-
    {"__inputs":[{"name":"DS_LOKI","label":"Loki","description":"","type":"datasource","pluginId":"loki","pluginName":"Loki"},{"name":"DS_PROMETHEUS","label":"Prometheus","description":"","type":"datasource","pluginId":"prometheus","pluginName":"Prometheus"}],"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"7.5.0"},{"type":"datasource","id":"loki","name":"Loki","version":"1.0.0"},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"logs","name":"Logs","version":""},{"type":"panel","id":"timeseries","name":"Time series","version":""}],"annotations":{"list":[]},"description":"Loki stack monitoring - detects issues in Loki/Promtail when deployed in Kubernetes","editable":true,"gnetId":14055,"graphTooltip":0,"id":null,"links":[],"panels":[{"datasource":"${prometheus_datasource}","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":0},"id":2,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"single"}},"targets":[{"expr":"sum(rate(promtail_sent_entries_total{namespace=~\"$namespace\"}[5m])) by (pod)","legendFormat":"{{pod}}","refId":"A"}],"title":"Promtail - Log entries sent/s","type":"timeseries"},{"datasource":"${prometheus_datasource}","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":0},"id":4,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom"},"tooltip":{"mode":"single"}},"targets":[{"expr":"sum(rate(promtail_dropped_entries_total{namespace=~\"$namespace\"}[5m])) by (pod)","legendFormat":"{{pod}}","refId":"A"}],"title":"Promtail - Dropped entries/s","type":"timeseries"},{"datasource":"${loki_datasource}","gridPos":{"h":10,"w":24,"x":0,"y":8},"id":6,"options":{"dedupStrategy":"none","showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":true},"targets":[{"expr":"{namespace=~\"$namespace\", app=~\"loki|promtail\"} |~ \"(error|warn|ERR|WARN)\"","refId":"A"}],"title":"Loki/Promtail - Errors & Warnings","type":"logs"}],"refresh":"30s","schemaVersion":30,"style":"dark","tags":["loki","promtail","monitoring"],"templating":{"list":[{"current":{},"hide":0,"includeAll":false,"label":"Prometheus","name":"prometheus_datasource","options":[],"query":"prometheus","refresh":1,"type":"datasource"},{"current":{},"hide":0,"includeAll":false,"label":"Loki","name":"loki_datasource","options":[],"query":"loki","refresh":1,"type":"datasource"},{"allValue":".*","current":{},"datasource":"${prometheus_datasource}","definition":"label_values(promtail_sent_entries_total, namespace)","hide":0,"includeAll":true,"label":"Namespace","multi":false,"name":"namespace","query":"label_values(promtail_sent_entries_total, namespace)","refresh":2,"sort":1,"type":"query"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Loki Stack Monitoring","uid":"loki-stack-monitoring","version":1}
